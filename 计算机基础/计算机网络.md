---
tags:
  - 计算机网络
---

# 一、 体系概述
![3850e953e8917849d5343ba33dd5300.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/22139374/1661824336138-9260ffc7-a844-4855-9888-7e69931c0ffe.jpeg#clientId=u9bf189b2-177b-4&from=paste&height=720&id=u0a7dd3c1&name=3850e953e8917849d5343ba33dd5300.jpg&originHeight=1080&originWidth=1728&originalType=binary&ratio=1&rotation=0&showTitle=false&size=276766&status=done&style=none&taskId=u7fdd7e1e-3c4e-4420-9878-4da6fb2744b&title=&width=1152)

## 0.1. OSI参考模型
OSI七层模型是计算机网络通信协议的标准架构，将网络通信分为七个层次，每个层次都有自己的功能和协议。下面是每个层次的简要概述：

1.物理层（Physical Layer）：负责传输比特流，描述物理介质的特性和传输介质的接口标准。

2.数据链路层（Data Link Layer）：负责将比特流转换成帧，进行透明传输、差错校验和流量控制等。

3.网络层（Network Layer）：负责将数据包从源主机传输到目的主机，进行路由选择、拥塞控制和网络地址转换等。

4.传输层（Transport Layer）：负责提供端到端的可靠传输服务，进行分段、重组、流量控制和数据传输的可靠性保证等。

5.会话层（Session Layer）：负责建立、管理和终止通信会话，进行会话控制和同步等。

6.表示层（Presentation Layer）：负责数据格式的转换和编码，进行数据格式的表示和转换。

7.应用层（Application Layer）：负责提供各种应用程序的接口，进行数据交换和应用程序的协议处理等。

OSI七层模型的优点是可以方便地划分和组织网络协议，不同层次的协议可以独立地进行设计和实现，从而提高了网络协议的可扩展性和互操作性。

## 0.2. TCP/IP参考模型
  
TCP/IP参考模型是一个由美国国防部高级研究计划署（DARPA）开发的网络通信协议标准。它将网络通信分为四个层次，每个层次都有自己的功能和协议。下面是每个层次的简要概述：

1.网络接口层（Network Interface Layer）：负责将数据包转换为比特流，并通过物理介质进行传输。该层次包括硬件设备和驱动程序。

2.网络层（Internet Layer）：负责将数据包从源主机传输到目的主机，并进行路由选择和拥塞控制等。该层次包括IP协议和路由协议等。

3.传输层（Transport Layer）：负责提供端到端的可靠传输服务，并进行分段、重组、流量控制和数据传输的可靠性保证等。该层次包括TCP协议和UDP协议等。

4.应用层（Application Layer）：负责提供各种应用程序的接口，进行数据交换和应用程序的协议处理等。该层次包括HTTP协议、FTP协议、SMTP协议等。

## 0.3. TCP/IP功能列表

1.  网络接口层（Network Interface Layer）：

-   物理地址寻址
-   帧封装和解封装
-   差错检测和纠正
-   流量控制
-   链路管理

2.  网络层（Internet Layer）：

-   IP地址寻址
-   路由选择
-   拥塞控制
-   分段和重组
-   网络地址转换

3.  传输层（Transport Layer）：

-   端到端的可靠传输
-   分段和重组
-   连接管理和维护
-   流量控制
-   数据传输的可靠性保证

4.  应用层（Application Layer）：

-   提供各种应用程序的接口
-   应用程序的协议处理
-   数据交换
-   安全认证和加密
-   文件传输和共享


# 1. 互联网的组成

- 从组成部分看，分硬件，软件，协议三大部分
- 从工作方式看，分边缘部分，核心部分
- 从功能上看，分通信子网，资源子网
## 1.1.1. 边缘部分

1.  **含义：**
由互联网上的主机（端系统）组成
是用户直接使用的部分，用来进行通信（主机上的进程的通信）和资源共享 
2.  **通信方式的两大类：**
1）_客户-服务器方式_（C/S）：
		a. 含义：最常用与传统的方式，一方请求服务，一方提供服务，通信可以是单向的，也可以是双向的
		b. 主要特征：客户是服务请求方，服务器是服务提供方
		c. 客户程序：被用户调用后运行，发送请求给服务器，所以要知道服务器程序地址
								不需要特殊的硬件和很复杂的操作系统
		d. 服务器程序：提供服务的程序，可同时处理多个客户请求
								   系统启动自动调用不断运行，被动等待接受客户的通信请求，所以不需要知道客户程序地址
								   需要强大的硬件和操作系统支持
2）_对等连接方式_(P2P)：
			含义：两台主机不区分服务器和客户，只要都运行p2p软件，就可以进行平等对等连接通信
						双方可以访问对方硬盘中的共享文档
						可支持大量对等用户同时工作 
## 1.1.2. 核心部分
 核心部分中**最重要的功能**：**路由器**
			路由器是一种专用计算机，是实现分组交换的关键部件，其任务是转发收到的分组 

> 交换：按照某种方式动态分配传输线路的资源



# 2. 计算机网络的功能

1. 数据通信
2. 资源共享
3. 分布式处理
4. 提高可靠性
5. 负载均衡


# 3. 三种交换方式

**1）**_**电路交换**_**：**
		a. 工作方式：在两用户端间建立一条专用的物理通路，保证了双方通信所需的通信资源
								这些资源在双方通信时也不会被其他用户占用
		b. 三个步骤：建立连接(占用通信资源)->通话(一直占用通信资源)->释放连接(归还通信资源)
		c. 重要特点：在通话的全部时间内，通话的两个用户**始终占用**端到端的通信资源
**2）**_**报文交换**_**：**
特点：整个报文先传送到相邻结点，全部存储下来后查找转发表，转发给下一个结点
**3）**_**分组交换**_**：**
		a. 工作方式：采用存储转发技术，把一个报文 (要发的整块数据) 划分为几个分组后进行传送
		b. 分组：把较长的报文分成更小的等长数据段
						加上必要的控制信息组成的首部后，就构成一个分组
		c.  首部的重要性：包含了诸如目的地址和源地址等重要控制信息
										使每一个分组才能独立的选择传输路径，并正确交付到终点
		d.  存储转发技术：路由器收到分组后，先暂时存储，检查其首部，查找转发表
										按照首部中目的地址，选择合适的接口转发出去
		e.  **优点：** 

   - 高效：在分组传输过程动态分配传输带宽，对通信链路**逐段占用**
   - 灵活：为每个分组独立选择**最合适**的转发路由
   - 迅速：以分组为单位传输，**不用建立和释放连接**
   - 可靠：保证可靠性的网络协议；**分布式**多路由器的分组交换网，有很好的生存性



**三种交换的特点概述：**
1）电路交换：整个报文的比特流**连续**的从源点直达终点，好像在管道中传送
适用于连续传送大量数据，传输速率较快
2）报文交换：整个报文先传送到**相邻结点**，全部存储下来后查找**转发表**，转发给下一个结点
信道利用率高
3）分组交换：单个**分组**传送到**相邻结点**，存储下来后查找**转发表**，转发给下一个结点
信道利用率高，时延小，灵活性高 

# 4. 不同类别的计算机网络

## 4.1.1. 网络的作用范围分类：

1. 广域网(WAN)：作用范围几十到几千公里，是互联网的核心部分·
广域网各结点采用**高速链路**，有较大通信容量，可以长距离运送数据
2. 城域网(MAN)：作用范围一个城市，用来将多个局域网进行互联，多采用**以太网技术**
3. 局域网(LAN)：作用范围1km左右，一般用微机或工作站通过**高速通信线路**相连
4. 个人区域网(PAN)：作用范围10m左右，把属于个人的设备用**无线技术**相连
也叫无线个人区域网(WPAN)

## 4.1.2. 按照网络的使用者分类：

1. 公用网：电信公司出资建造的**大型网络**，任何人都可**付费使用**，也称公众网
2. 专用网：为满足**特殊业务**需要建立的网络，不向外人提供服务

# 5. 计算机网络的性能指标
## 5.1.1. 速率

1. 定义：数据的传送速率；常指**额定速率**或标称速率，并不是实际的速率
2. 单位：bit/s(比特每秒)
## 5.1.2. 带宽

1. 定义：表示网络中某通道传送数据的能力，即单位时间内网络中某信道能通过的**最高数据率**
2. 单位：bit/s
## 5.1.3. 吞吐量

1. 定义：单位时间内通过某网络的**实际**的数据量
2. 单位：bit/s
## 5.1.4. 时延

1.  定义：数据从网络的一段传送到另一端所需的时间；又称延迟或迟延 
2.  组成：
1）发送时延：
a. 定义：是主机或路由器**发送数据帧所需要的时间**
b. 发生位置：在机器内部的发送器中，即网络适配器中，与信道长度无关
c. 计算公式：![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028737540-9e7510ff-d3c1-4c1e-8ccb-42d4fb894470.png#clientId=u4d4fe1f6-f383-4&id=EAcYQ&name=image.png&originHeight=104&originWidth=520&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35750&status=done&style=none&taskId=u0067d379-c38b-40fc-a4f0-ce5be50bd48&title=) 

	2）传播时延：

				a. 定义：是电磁波在信道中传播一定距离所需要的时间
				b. 发生位置：在机器外部的传输信道媒体上，与信号的发送速率无关，只与信号传送的距离有关

				c. 计算公式：
![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028737568-ff420f40-ce9d-4722-8481-a6927d6a9a12.png#clientId=u4d4fe1f6-f383-4&id=TTIYl&name=image.png&originHeight=96&originWidth=586&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30292&status=done&style=none&taskId=uc4312592-5279-4358-9557-cfd3305eb01&title=)

	3）处理时延：
				定义：主机或路由器收到分组后处理分组所用的时间；如分析首部、提取数据、差错检验、转发路由查找等

	4）排队时延：
				a. 含义：分组经过路由器时，在路由器中经历输入和输出的排队等待时间
				b. 发生位置：各 中转路由器 中；取决于网络的通信量的大小

> 总时延=发送时延+传播时延+处理时延+排队时延


	5）时延带宽积：
				定义：

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028737585-8a91a0cd-78af-47bb-b3d8-6f49cf61bf7c.png#clientId=u4d4fe1f6-f383-4&id=cCWHP&name=image.png&originHeight=36&originWidth=421&originalType=binary&ratio=1&rotation=0&showTitle=false&size=13492&status=done&style=none&taskId=ua31f546b-cd1c-4e56-b1bc-2ee5e3d12a2&title=)

	6）往返时间**RTT**：
				定义：双向**交互一次所需的时间**；包含中间各结点的处理时延、排队时延、转发数据时的发送时延
	7）利用率：
				a. 信道利用率：指某信道有百分之几的时间是被利用的
				b. 网络信道利用率：全网络的信道利用率的加权平均数
				c. D=D0/1-U    其中D是网络时延、D0是空闲时网络时延、U是利用率
				d. 特点：信道或网络利用率过高会产生非常大的时延

# 6. 体系结构对比

_三个协议的每一层的名称_
![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028737729-c5349bd7-523e-4add-a4ce-60c1f5dbefad.png#clientId=u4d4fe1f6-f383-4&id=IQ4Yy&name=image.png&originHeight=502&originWidth=869&originalType=binary&ratio=1&rotation=0&showTitle=false&size=190885&status=done&style=none&taskId=ud710fe5a-0649-4704-8d49-42e76d09ee4&title=)

![127de339c9e6236dace09e8ba3cf450.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/22139374/1661824357220-32927f01-4454-4306-89b4-6a3afc49ce6c.jpeg#clientId=u9bf189b2-177b-4&from=paste&height=720&id=u9c3c47aa&name=127de339c9e6236dace09e8ba3cf450.jpg&originHeight=1080&originWidth=1728&originalType=binary&ratio=1&rotation=0&showTitle=false&size=338981&status=done&style=none&taskId=ub762cc0c-bc40-4593-a30e-9a32f01af77&title=&width=1152)![e8a4d7c8f3db680766d8cdbaa814698.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/22139374/1661824362410-96ab7471-80e1-455d-994e-4546803048a5.jpeg#clientId=u9bf189b2-177b-4&from=paste&height=720&id=uc35a1d3d&name=e8a4d7c8f3db680766d8cdbaa814698.jpg&originHeight=1080&originWidth=1728&originalType=binary&ratio=1&rotation=0&showTitle=false&size=297480&status=done&style=none&taskId=u780def2a-75b6-4426-8f64-d91cfa60a3e&title=&width=1152)

## 6.1.1. OSI模型与TCP/IP的不同点
![2706cd1fb10c53f71d5cb30c47632b0.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/22139374/1661824368462-5d2cc23f-9fc1-4d55-be2b-a0f066126fbd.jpeg#clientId=u9bf189b2-177b-4&from=paste&height=720&id=u094353ad&name=2706cd1fb10c53f71d5cb30c47632b0.jpg&originHeight=1080&originWidth=1728&originalType=binary&ratio=1&rotation=0&showTitle=false&size=409591&status=done&style=none&taskId=uaa9a1393-e400-4dd2-a79e-a9740e0497c&title=&width=1152)

# 7. 习题

**分组交换的要点**

1. 报文分组，加首部
2. 经路由器储存转发
3. 在目的地合并

**多方面比较电路交换、报文交换、分组交换的优缺点**

1. 电路交换：端对端通信质量因约定了通信资源获得可靠保障，对连续传送大量数据效率高。
2. 报文交换：无须预约传输带宽，动态逐段利用传输带宽对突发式数据通信效率高，通信迅速。
3. 分组交换：具有报文交换之高效、迅速的要点，且各分组小，路由灵活，网络生存性能好。

**互联网的两大组成部分（边缘部分和核心部分）的特点是什么？他们的工作方式各有什么特点？**

边缘部分：由各主机构成，用户直接进行信息处理和信息共享;低速连入核心网。

核心部分：由各路由器连网，负责为边缘部分提供高速远程分组交换。

求发送时延和传播时延

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028737703-36340636-39f7-421c-be61-30bef14671e1.png#clientId=u4d4fe1f6-f383-4&id=pemmJ&name=image.png&originHeight=511&originWidth=1129&originalType=binary&ratio=1&rotation=0&showTitle=false&size=119117&status=done&style=none&taskId=ub5e14a11-55f0-4f93-a468-0f5bcf3b7f5&title=)

**计算接收方收完文件最后一个比特的所需时间**

**M：作为存储单位 10****20****，作为带宽速率 10****6**
**题目：**

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028738226-41c8ea62-d657-4b1b-af00-5437f936bdc8.png#clientId=u4d4fe1f6-f383-4&id=RAtdf&name=image.png&originHeight=262&originWidth=1204&originalType=binary&ratio=1&rotation=0&showTitle=false&size=215511&status=done&style=none&taskId=uaa27a98a-6cb0-4f1f-a779-8a66a97acb3&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028738610-def95fe8-b52a-4d31-80ef-40452635035b.png#clientId=u4d4fe1f6-f383-4&id=g5nrP&name=image.png&originHeight=371&originWidth=1209&originalType=binary&ratio=1&rotation=0&showTitle=false&size=242414&status=done&style=none&taskId=u1a050c7a-26af-4918-bdf3-8ccc2350b8d&title=)

**解答：**

目的已知条件中的M= 220 = 1048576,  K = 210 = 1024。

1.  1.5 MB= 1.5 x 1048576 B = 1.5 x 1048576 x 8 bit= 12582912 bit。
发送这些比特所需时间=12582912 / 107 = 1.258 s。 最后一个分组的传播时间还需要0. 5 x RTT = 40 ms。
总共需要的时间=2 x RTT + 1.258 + 0.5 x RTT = 0.16 + 1.258 + 0.04 = 1.458 s 。 
2.  需要划分的分组数=1.5 MB / 1 KB = 1536。
从第一个分组到达直到最后一个分组到达要经历1535 x RTT = 1535 x 0.08 = 122.8 s 。
总共需要的时间=1.458 + 122.8 = 124.258 s 。 
3.  在每一个RTT 往返时间内只能发送20个分组。 1536 个分组，需要76 个RTT, 76 个
RTT 可以发送76x20=1520 个分组，最后剩下 16 个分组，一次发送完。
但最后一次发送的分组到达接收方也需要0.5 x RTT。
因此，总共需要的时间=76.5 x RTT + 2 x RTT = 6.12 + 0.16 = 6.28 s 。 
4.  在两个RTT后就开始传送数据
经过n 个RTT 后就发送了 1 + 2 + 4 + ... + 2^n = 2^(n + 1) - 1  个分组。
若n =9, 那么只发送了2^10 — 1 = 1023 个分组。可见9 个RTT 不够。
若n = 10, 那么可以发送2^11 -1 = 2047 个分组。可见10 个RTT 足够了。
考虑到建立TCP连接的时间和最后分组传送到终点需要，
现在总共需要的时间=(2 + 10 + 0.5) x RTT = 12.5 x 0.08 = 1 s 

# 二、物理层

## 1. 物理层的基本概念
传输媒体接口的特性：
(1)机械特性：接口所用接线器的形状和尺寸、引脚数目和排列、固定和锁定装置等
(2)电气特性：接口电路的各条线上出现的电压范围
(3)功能特性：某条线上出现某一电平电压的意义
(4)过程特性：对于不同功能的各种可能事件的出现顺序

## 2. **数据通信的基础知识**

### 2.1. 信号分类
常用术语：
**消息**：通信的目的是传送消息，如语音、文字、图像、视频等
**数据**：是运送消息的实体；使用特点方式表示的信息，通常是有意义的符号序列
**信号**：数据的电气或电磁表现

-  **模拟信号(连续信号)**：代表消息的参数取值是连续的 
-  **数字信号(离散信号)**：代表消息的参数的取值是离散的 
-  **码元**：代表不同离散数值的基本波形 

**信道**：表示向某一个方向传送信息的媒体
### 2.2. 信息交互的三种方式

1.  **单向通信(单工通信)**：只能有一个方向的通信而没有反方向的交互；只需要一条信道 
2.  **双向交替通信(半双工通信)**：通信的双方都可以发送信息，但不能双方同时发送，而是一方发送另一方接收，一段时间后可以反过来；两条信道 
3.  **双向同时通信(全双工通信)**：通信双方可以同时发送和接收信息；两条信道；传输效率最高 
4.  **基带信号**：来自信源的信号；如计算机输出的代表文字或图像的数据信号都是基带信号 

### 2.3. 常用编码方式

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028738521-3b1c6c45-ebe5-419c-a63b-eb5a967bd159.png#clientId=u4d4fe1f6-f383-4&id=QCGkK&name=image.png&originHeight=132&originWidth=387&originalType=binary&ratio=1&rotation=0&showTitle=false&size=37927&status=done&style=none&taskId=ue00c894f-bd6d-4582-a3f9-e8541e62d39&title=)

-  **不归零制**：正电平代表1，负电平代表0 
-  **归零制**：正脉冲代表1，负脉冲代表0 
-  **曼切斯特编码**：位周期中心的向上跳变代表0，位周期中心的向下跳变代表1；也可反过来定义 
-  **差分曼切斯特编码**：在每一位的中心处始终都有跳变。位开始边界有跳变代表0，位开始边界没有跳变代表1 

### 2.4. 香农公式
**信噪比：**
    定义：信号的平均功率和噪声的平均功率之比，记作S/N
    公式：
**香农公式**：信道的极限信息传输速率C是
            ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028738546-5f6b1f4e-f4a4-475d-853f-e09ecd560fbd.png#clientId=u4d4fe1f6-f383-4&id=WE7af&name=image.png&originHeight=56&originWidth=246&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5565&status=done&style=none&taskId=u74410786-2bad-4403-9feb-bf88f80733b&title=)
         其中W为信道带宽，S为信道内所传信号的平均功率，N为信道内部的高斯噪声功率
        香农公式表明，信道的带宽或信道中的信噪比越大，信息的极限传输速率就越高
**香农公式的意义**：只要信息传输速率低于信道的极限速率，就一定存在某种方法来实现无差错的传输
### 2.5. 物理层下面的传输媒体

**传输媒体**：是数据传输系统中在发送器和接收器之间的物理通路
**传输媒体的分类**：

-  **导引型**：电磁波被引导沿着固体媒体传播 
   - 双绞线
   - 同轴电缆
   - 光纤
-  **非导引型**：电磁波无线传输 

### 2.6. 信道复用技术

**码分复用**（CDM）：
**原理**：各个用户使用进过特殊挑选的不同码型，因此彼此不会互相干扰
**码片：**每一个比特时间划分为m个短的间隔，称为码片
**工作方式**：
    每个站被指派一个唯一的m bit码片，若发送1，则发送自己的m bit码片，若发送0，则发送该码片的二进制反码
**码片实现扩频**：由于一个比特可转换成m个比特的码片，因此实际发送数据率提高了m倍
**重要特点**：每个站的码片必须各不相同，并相互正交
**码片正交关系**：不同码片正交，就是向量S和T的规格化内积为0，（规格化内积即对应为相乘）
**正交关系的重要特征**：任何码片与自己的规格化内积为1，与自己反码的规格化内积为-1

### 2.7. ADSL技术

**ADSL技术**：非对称数字用户线，将原有的模拟电话线进行改造，使其能够承载宽带业务，将0-4k的低端频谱留给电话使用，将剩余部分给宽带使用，其中上行带宽小于下行带宽
**传输距离**：与数据率和用户线的线径(粗细)有关
**传输速度**：与实际用户线的信噪比密切相关
**数据率**：采用自适应调制技术使用户线能够传输尽可能多的数据，受环境和线路条件影响较大
**特点**：上行和下行带宽不对称、需要在用户线两端各安装一个调制解调器

## 3. 习题

**物理层要解决哪些问题？物理层的主要特点是什么？**

解决的问题：

- 物理层要尽可能屏蔽掉物理设备、传输媒体和通信手段的不同，使上面的数据链路层感觉不到这些差异的存在，而专注于完成本层的协议与服务
- 给其服务用户（数据链路层）在一条物理的传输媒体上传送和接收比特流（一般为串行按顺序传输的比特流）的能力。为此，物理层应解决物理连接的建立、维持和释放问题。③在两个相邻系统之间唯一地标识数据电路。

主要特点：

- 由于在OSI之前，许多物理规程或协议已经制定出来了，而且在数据通信领域中，这些物理规程已被许多商品化的设备所采用。加之，物理层协议涉及的范围广泛，所以至今没有按OSI的抽象模型制定一套新的物理层协议，而是沿用已存在的物理规程，将物理层确定为描述与传输媒体接口的机械、电气、功能和规程特性。
- 由于物理连接的方式很多，传输媒体的种类也很多，因此，具体的物理协议相当复杂。

**假定某信道受奈氏准测限制，最高码元速率为20000码元/s，采用振幅调制，把码元的振幅划分成16个不同等级来传送，求最高能获得的数据率**

香农公式：
C=R_log(16)=20000b/s_4=80000b/s
16种状态用4bits表示，码元速率为20000码元/s，每个码元能表示4bits，故答案为20000*4

**常见的传输媒体有哪几种？各有何特点？**

**双绞线：**

-  抗电磁干扰 
-  模拟传输和数字传输都可以使用双绞线 

**同轴电缆：**

- 同轴电缆具有很好的抗干扰特性

**光纤：**

- 传输损耗小，中继距离长，对远距离传输特别经济；
- 抗雷电和电磁干扰性能好；
- 无串音干扰，保密性好，也不易被窃听或截取数据；
- 体积小，重量轻。

**电磁波：**

- 微波波段频率很高，其频段范围也很宽，因此其通信信道的容量很大；
- 微波传输质量较高；
- 微波接力通信的可靠性较高；
- 微波接力通信与相同容量和长度的电缆载波通信比较，建设投资少，见效快。

微波接力通信也存在如下的一些缺点：

- 相邻站之间必须直视，不能有障碍物。
- 微波的传播有时也会受到恶劣气候的影响；
- 与电缆通信系统比较，微波通信的隐蔽性和保密性较差；
- 对大量的中继站的使用和维护要耗费一定的人力和物力。

**共有四个站进行码分多址通信，四个站的码片序列分别为**

A(-1-1-1+1+1-1+1+1)        B(-1-1+1-1+1+1+1-1)
C(-1+1-1+1+1+1-1-1)        D(-1+1-1-1-1-1+1-1)
现收到这样的码片:(-1+1-3+1-1-3+1+1)，问哪些站发送了数据，发送的是0还是1

```
解：

    A站的内积：(-1-1-1+1+1-1+1+1)*(-1+1-3+1-1-3+1+1)/8=(+1-1+3+1-1+3+1+1)/8=1

    B站的内积：(-1-1+1-1+1+1+1-1)*(-1+1-3+1-1-3+1+1)/8=(+1-1-3-1-1-3+1-1)/8=-1

    C站的内积：(-1+1-1+1+1+1-1-1)*(-1+1-3+1-1-3+1+1)/8=(+1+1+3+1-1-3-1-1)/8=0

    D站的内积：(-1+1-1-1-1-1+1-1)*(-1+1-3+1-1-3+1+1)/8=(+1+1+3-1+1+3+1-1)/8=1

    所以A、D站发送了1，B站发送了0，C站没有发送
```

# 三、数据链路层

## 1. 三个基本问题

### 1.1.1. 1.封装成帧：

-  封装成帧：就是在一段数据前后分别添加首部和尾部，确定帧的界限，然后就构成了一个帧 
-  添加首部和尾部的作用：进行帧定界(确定帧的界限)；包含许多必要的控制信息 
-  帧长：帧的数据部分加上帧首部和帧尾部的长度 
-  最大传送单元MTU：链路层协议规定的所能传送的帧的数据部分长度上限 
-  帧格式：![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028739144-0b00abae-2361-4f3b-a591-266cad52c4f2.png#clientId=u4d4fe1f6-f383-4&id=bDZT7&name=image.png&originHeight=126&originWidth=345&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23902&status=done&style=none&taskId=u9b5bfcb3-c3ef-45fd-b117-43268eccb57&title=) 
-  帧界定的方法：可用特殊的帧定界符，在ACSCII码中，用SOH表示帧的首部开始，EOT表示帧的结束 
-  帧界定的作用：判断收到的帧是否完整，不完整则丢弃 

### 1.1.2. 2.透明传输：

- 透明传输：不管什么数据，都能完整无差错的通过这个数据链路层，数据链路层对数据没有妨碍，数据链路层对数据时透明的
- 透明传输：不管什么数据，都能完整无差错的通过这个数据链路层，数据链路层对数据没有妨碍，数据链路层对数据时透明的
- 解决方法：字节填充，在控制字符和特殊字符前插入一个转义字符"ESC"，而真正的首部和尾部前不加

### 1.1.3. 3.差错检测：

- 比特差错：在传输中可能会产生比特差错，1可能变0，0可能变1
- 误码率：在一段时间，传输错误的比特占所有传输比特总数的比率，与信噪比有关
- **循环冗余校验(CRC)：** 
   - 原理：在发送端，先把数据划分为组，假定每组k个比特，若传输一组数据M=101001(k=6)，在M后添加供差错检测用的n位冗余码后一起发送，共发送(k+n)位，接收方用收到的数据除P，若余数为0则表示没有差错
   - 冗余码计算方法：在M后面添加n个0，得到（k+n）位的数除以选定好的除数p，得出商Q，余数R，将余数R作为冗余码，添加到M后
   - 帧校验序列(FCS)：为差错检验而添加的冗余码；就是计算后得到的余数R
   - 生成多项式：一种方便的表示循环冗余校验过程的方法
- 传输差错的分类： 
   - 比特差错：1变0，0变1
   - 帧丢失：丢失某个帧
   - 帧重复：某个帧收到多次
   - 帧失序：后发送的帧反而先到达接收端
- **CRC的局限性：只能实现无比特差错，不能实现无传输差错，只能判断收到的数据是否正确，其余均无法判断，并不是可靠传输 **
   - 无差错接受：接收端数据链路层接受的帧，都能认为在传输过程中没有产生差错
   - 可靠传输：发送端发送什么，接收端就收到什么

## 2. 零比特填充

- 当PPP使用同步传输时，使用零比特填充
- 零比特填充的具体方法： 
   - (1)在发送端先扫描整个信息字段(通常使用硬件实现，但也可以用软件实现，但是会慢一些)
   - (2)只要发现有5个连续的1，则立即填入一个0。
   - (3)接收端在收到一个帧时，先找到标志字段F以确定帧的边界，接着再用硬件对其中的比特流进行扫描，每当发现5个连续1时，就把5个连续1后的一个0删除，以还原成原来的信息比特流。
- 因此通过这种零比特填充后的数据，就可以保证在信息字段中不会出现连续6个1。

## 3. CSMA/CD协议

-  总线的特点：当一台主机发送数据时，总线上所有主机都能检测到这个数据，就是广播通信方式
为使通信简便采取的措施 
   - (1)采用无连接工作方式，不必先建立连接就可以直接发送数据；适配器对数据帧不编号，不要求发回确认；因此，以太网提供尽最大努力交付，是不可靠交付；收到差错帧则丢弃，是否重传由高层决定，和以太网无关；同一时间只允许一台主机发送数据；使用CSMA/CD协议
   - (2)发送的数据使用曼切斯特编码
-  CSMA/CD协议要点： 
   - (1)多点接入：说明是总线型网络
   - (2)载波监听：检测总线上有没有其他计算机也在发送；每个主机必须不停的检测信道，发送前检测是为了获得发送权，发送中检测是为了及时发现碰撞
   - (3)碰撞检测：边发松边监听，也叫冲突检测；发生碰撞就立即停止发生，等待一段随机时间后再次发送

## 4. MAC层的硬件地址

- 定义：又叫物理地址或硬件地址；就是适配器的标识符，用48位二进制数来标识网卡的硬件地址，表示为6个16进制数，在局域网内具有唯一性
- I/G位：地址字段第一个字节的最低位；为0表示单个站地址、为1表示组地址，用来进行多播
- I/G位：地址字段第一个字节的最低位；为0表示单个站地址、为1表示组地址，用来进行多播
- 适配器的过滤功能：适配器收到MAC帧后检查帧中目的地址，若发往本站则收下，否则丢弃 
   - 发往本站的帧： 
      - (1)单播帧：一对一，即收到的帧的MAC地址与本站的硬件地址相同
      - (2)广播帧：一对全体，即发送给本局域网上所有站点的帧(全1地址)
      - (3)多播帧：一对多，即发送给本局域网上一部分站点的帧

## 5. 扩展的以太网

- 在物理层扩展以太网：集线器、光纤
- **在数据链路层扩展以太网** 
   - 网桥：对收到的帧根据MAC帧目的地址查找地址表进行转发和过滤
   - 交换机：工作在数据链路层，实质就是一个多接口网桥 
      - *特点：交换机上的主机是全双工工作，不会产生冲突，交换机中存有地址表通过自学习算法建立，交换机上所有端口在同一个广播域上
      - 帧转发方式： 
         - 直通：收到帧之后直接转发，不必事先把整个数据帧缓存，但也不对帧进行检验
         - 存储转发：将所有帧都收到后进行检查，然后再发送
   - *交换机的自学习功能： 
      - 地址表的形成：收到未知的地址后，存储源地址和接口的对应关系，向除来源端口的其它端口广播，目的地址不符则丢弃，否则接收并回复，收到回复后存储对应关系；地址表有有效时间，超过有效时间则失效
      - 生成树协议STP：解决无限循环的问题

## 6. 高速以太网

- 常用速率为1Gbit/s的吉比特以太网
- 100BASE-T以太网 
   - 在双绞线上传送的100Mbit/s基带信号的星形拓扑以太网，又称为快速以太网

## 7. 习题

-  .数据链路层的三个基本问题为什么必须解决？ 
   - 解：帧定界是分组交换的必然要求；透明传输避免消息符号与帧定界符混淆；差错检验防止差错的无效帧浪费后续路由上的传输和处理资源
-  假定1km长的CSMA/CD网络的数据率为1Gb/s。设信号在网络上的传播速率为200000km/s。求能够使用此协议的最短帧长。 
   - 解：对于1km长的电缆，单程传播时间为1/200000=5μs，来回传播时间即为10μs，所以最小帧的发射时间不能小于10μs，以1Gb/s速率工作，10μs能发送的比特数为10*10-6*1*109=10000.因此，最短帧长是10000位
-  有10个站连接到以太网上。试计算一下三种情况下每一个站所能得到的带宽。 
   -  （1）10个站都连接到一个10Mb/s以太网集线器； 
      - 解：10个站共享10MB/s
   -  （2）10个站都连接到一个100Mb/s以太网集线器； 
      - 解：10个站共享100MB/s
   -  （3）10个站都连接到一个10Mb/s以太网交换机。 
      - 解：每个站独享10MB/s
-  如图，以太网交换机有6个接口，分别连接5台主机和一个路由器，完成下表 
   - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028739434-f8b5580f-e11d-4e3e-9b81-4c1c087926ee.png#clientId=u4d4fe1f6-f383-4&id=Cpcf7&name=image.png&originHeight=459&originWidth=801&originalType=binary&ratio=1&rotation=0&showTitle=false&size=99112&status=done&style=none&taskId=u912da1e9-f8a7-49b0-a534-e2b7640cc5a&title=)
   - ![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028739445-611e15f9-613d-4d8c-a951-2b229c03e087.png#clientId=u4d4fe1f6-f383-4&id=x8N7b&name=image.png&originHeight=270&originWidth=454&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16808&status=done&style=none&taskId=u9aa6b0eb-e4d0-4dc2-93fd-c9d708b8388&title=)

 

# 四 、网络层

## 1. 分类的IP地址

### 1.1. IP地址及其表示方法

1.  IP地址：
IP地址就是给互联网上的每一台主机（或路由器）的每一个接口分配一个在全世界范围内是**唯一的32位的标识符**
IP地址的结构是我们可以在互联网上很**方便地进行寻址** 
2.  IP地址的编址方法：
	1）**分类的IP地址**：是最基本的编址方法
    2）子网的划分：对最基本编址方法的改进
	3）构成超网：比较新的无分类编址方法 
3.  分类的IP地址：
	1）定义：将IP地址划分为若干个固定类，每一类地址都由两个固定长度的字段组成。
		  第一个字段是网络号(net-id)，第二个字段是主机号(host-id)构成 

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028739321-317e7283-2419-4c81-acba-c15a55336f2e.png#clientId=u4d4fe1f6-f383-4&id=JsoqK&name=image.png&originHeight=645&originWidth=954&originalType=binary&ratio=1&rotation=0&showTitle=false&size=239811&status=done&style=none&taskId=ua2ed4ae7-8362-4dae-ba9c-45ecd7cebd4&title=)

4. IP地址的记法：点分十进制记法

### 1.2. IP地址的指派范围

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028739476-0459209d-b25f-48ca-9df8-de67feb7e196.png#clientId=u4d4fe1f6-f383-4&id=D2DSC&name=image.png&originHeight=174&originWidth=794&originalType=binary&ratio=1&rotation=0&showTitle=false&size=54389&status=done&style=none&taskId=u3b8f1a6a-b383-4caa-bf59-e42a55097f9&title=)

### 1.3. 一般不使用的特殊IP地址

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028739914-5b9ef589-051e-4d44-a5fd-3d6a577d1fe7.png#clientId=u4d4fe1f6-f383-4&id=ToFnM&name=image.png&originHeight=212&originWidth=768&originalType=binary&ratio=1&rotation=0&showTitle=false&size=79587&status=done&style=none&taskId=uf8e5bbe9-18e7-431b-b6d6-4cfb7f4bd37&title=)

### 1.4. IP地址的一些重要特点

1. 每一个IP地址都由网络号和主机号两部分组成，是一种分等级的地址结构
2. 实际上IP地址是标志一个主机或(路由器)和一条链路的接口
3. 用转发器或网桥连接起来的若干给局域网仍为一个网络，因为这些局域网都具有同样的网络号net-id
4. 所有分配到网络号的网络都是平等的

### 1.5. IP地址与硬件地址

P地址与硬件地址区别：
从层次看，硬件地址或物理地址是数据链路层和物理层使用的地址，IP地址是网络层和以上各层使用的地址，是一种逻辑地址![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028740142-5ff08ea5-7b05-4535-848b-4a1a5de804c9.png#clientId=u4d4fe1f6-f383-4&id=F69Og&name=image.png&originHeight=340&originWidth=849&originalType=binary&ratio=1&rotation=0&showTitle=false&size=86455&status=done&style=none&taskId=u996a31b3-381e-4426-a1e7-00b3bcdc48c&title=)

## 2. 地址解析协议ARP

**作用：**从网络层使用的IP地址，解析出在数据链路层使用的硬件地址

**工作方式：**每个主机里都设有一个ARP高速缓存，里面有所在局域网上各主机和路由器的IP地址到硬件地址的映射表，且这个映射表经常动态更新

**工作流程：**当主机A向局域网上某个主机B发送IP数据报时，先在ARP高速缓存中查看有无主机B的IP地址，若有，就可查出对应的硬件地址，反之，执行ARP请求分组

**特点：**

ARP协议只解决同一局域网上IP地址和硬件地址映射问题，不在同一局域网则无法解决

ARP工作过程对用户来说是透明的

## 3. IP层分组转发分组的流程

1.  基础知识点：
每个路由器路由表表项数：每有一个网络就要有一个路由表项
接口所在网络为直连网络，直接交付
特定主机的路由：给特定主机指定路由表，通过指定路线访问目标主机
默认路由：可以减少路由表所占用的空间和搜索路由表所用的时间，将不在路由表中的网络都连向默认路由
路由表：只有目标网络和对应的下一跳地址，并不储存到某个网络的完整路径 
2.  分组转发算法：
(1)从数据报的首部提取目的主机的IP地址D，得出目的网络地址为N。
(2)若N就是与此路由器直接相连的某个网络地址，则进行直接交付，不需要再经过其他的路由器，直接把数据报交付给目的主机（这里包括把目的主机地址D转换为具体的硬件地址，把数据报封装为MAC帧，再发送此帧）；否则就要执行(3)进行间接交付。
(3)若路由表中有目的地址为D的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器，否则执行(4)。
(4)若路由表中有到达网络N的路由，则把数据报传送给路由表中所指明的下一跳路由器，否则执行(5)。
(5)若路由表中有一个默认路由，则把数据报传送给路由表中所指明的下一跳路由器，否则执行(6)。
(6)报告转发分组出错。 

## 4. 划分子网

1.  两级IP地址的问题：
IP地址空间利用率有时很低
给每个屋里网络分配一个网络号会使路由表变得很大，因此是网络性能变坏
两级IP地址不够灵活 
2.  划分子网的基本思路：借用主机号若干位作为子网地址 
3.  划分子网后的IP地址：| 网络号 | (子网) | 主机号 | 

## 5. 子网掩码

1. 作用：用来找出IP地址中的子网部分，长度为32位，原IP中网络号和子网部分置为1，主机号部分置为0

> (IP地址)and(子网掩码)=网络地址


2.  默认子网掩码：在不进行子网划分时，也要给出子网掩码，就用默认子网掩码 
3.  子网划分方法**：**
     1）固定长度划分：所划分的所有子网的子网掩码都是相同的，取所用最大的主机数进行划分
     2）变长划分：根据需求灵活划分 

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028740325-3ecf2586-9fe8-4be4-8075-1d38bb66bf2b.png#clientId=u4d4fe1f6-f383-4&id=CL3zc&name=image.png&originHeight=430&originWidth=878&originalType=binary&ratio=1&rotation=0&showTitle=false&size=237068&status=done&style=none&taskId=u6579f265-b8ce-41ee-b57d-0c2023a1e54&title=)

## 6. 网际控制报文协议ICMP

1. **作用：**ICMP允许主机或路由器_报告差错_和提供有关_异常情况_的报告

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028740370-34b16d4e-0695-482e-9333-cf1d5aa43932.png#clientId=u4d4fe1f6-f383-4&id=GIpRX&name=image.png&originHeight=300&originWidth=544&originalType=binary&ratio=1&rotation=0&showTitle=false&size=117414&status=done&style=none&taskId=u758d822f-ed7c-4631-822e-c12202faf62&title=)

2. **.ICMP报文种类：**差错报告报文，询问报文

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028740782-c132749f-1b65-471f-8746-7bd6b02e537f.png#clientId=u4d4fe1f6-f383-4&id=ftzbR&name=image.png&originHeight=395&originWidth=1110&originalType=binary&ratio=1&rotation=0&showTitle=false&size=149230&status=done&style=none&taskId=u69d0810b-8c18-4795-ac01-4140fbeec40&title=)

3. **不发送ICMP差错报告报文的情况：**

	(1)对ICMP差错报告报文，不再发送ICMP差错报告报文

    (2)对第一个分片的数据报片的所有后续数据报片，都不发送ICMP差错报告报文

    (3)对具有多播地址的数据报，都不发送ICMP差错报告报文

    (4)对具有特殊地址(如127.0.0.0或0.0.0.0)的数据报，不发生ICMP差错报告报文

4.  常用的ICMP**询问报文**：
(1)回送请求和回答：
		ICMP回送请求报文是由主机或路由器向一个特定的目的主机发出的询问，收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文，这种询问报文用来测试目的站是否可达以及了解其状态
(2)时间戳请求和回答：
		ICMP时间戳请求报文是请某台主机或路由器回答当前的日期和时间，再ICMP时间戳回答报文中有一个32位的字段，其中写入的整数代表从1900.1.1到当前时刻一共多少秒，用于时钟同步和时间测量 

## 7. 内部网关协议RIP

1.  **概述：**是一种分布式，基于距离的路由选择协议 
2.  **距离：**直连网络距离为1，每过一个非直连网络距离加1，距离也称为跳数，每经过一个路由器跳数就加1，距离实际上指最短距离 

RIP允许一个路径最多包含15个路由器，也就是距离最大值为16，故RIP适合小型互联网使用；RIP不能在两个网络之间同时使用多条路由

3.  **工作流程：**每个路由器每隔一段时间向外广播，每个路由器收到广播后更新自己的路由表
刚开始时只知道直连网络的距离，路由表为空，以后，每个路由器只和数目有限的相邻路由器交互并更新路由信息，经过若干次更新后，所有路由器最终会知道到达本自治系统其他路由器的最短距离和下一跳地址，此时称该网络收敛 
4.  **RIP协议的特点：**
(1)仅和相邻路由器交换信息，不相邻的路由器不交换信息
(2)交换的信息是当前本路由器所知道的全部信息，即其现在的路由表
(3)按固定时间间隔交换信息 
5.  **距离向量算法：**
(1)路由器收到地址为X的相邻路由器的一个RIP报文，修改报文中所有项目，把下一跳地址改为X，把距离字段值都+1
(2)对修改后的RIP报文中的每个项目重复以下步骤
		若项目中目的地址不在路由表中，则加入路由表；
		若下一跳给出的路由器地址与RIP报文传来地址相同，则用收到的项目替换原路由表中的项目
		若收到项目中的距离小于路由表中的距离，进行更新
(3)若超过3分钟未收到相邻路由信息，则将其标记为不可达，即把距离置为16
(4)返回 

## 8. 习题

### 8.1. IP 地址分为几类？各如何表示? IP 地址的主要特点是什么？

**解答**：

在IPv4 的地址中，所有的地址都是32 位，并且可记为：
IP 地址：：＝｛＜网络号＞，＜主机号＞｝

1. IP 地址共分为五类。
2. A 类地址：网络号字段为l  字节，最前面的1  位是0。
B 类地址：网络号字段为2 字节，最前面的2 位是10。
C 类地址：网络号字段为3 字节，最前面的3 位是110。
D 类地址：用千多播，最前面的4 位是1110。
E 类地址：保留今后使用，最前面的4 位是1111 。
3. IP 地址具有以下一些重要特点：
(1) 每一个IP 地址都由网络号和主机号两部分组成。从这个意义上说， IP 地址是一种分
等级的地址结构。
(2) 实际上IP 地址是标志一个主机（或路由器）和一条链路的接口。换言之， IP 地址并
不仅仅指明一个主机，同时还指明了主机所连接到的网络。

### 8.2. 试说明IP 地址与硬件地址的区别。为什么要使用这两种不同的地址？

**解答**：

1. 从层次的角度看，物理地址是数据链路层和物理层使用的地址，而IP 地址是网络
层和以上各层使用的地址，是一种逻辑地址（称IP 地址是逻辑地址是因为IP 地址是用软件
实现的）。
2. 由于全世界存在着各式各样的网络，它们使用不同的硬件地址。要使这些异构网络能
够互相通信就必须进行非常复杂的硬件地址转换工作，因此由用户或用户主机来完成这项
工作几乎是不可能的事。但统一的IP 地址把这个复杂问题解决了。连接到互联网的主机只需
拥有统一的 IP 地址，它们之间的通信就像连接在同一个网络上那样简单方便。当需要把 IP
地址转换为物理地址时，调用ARP 的复杂过程都由计算机软件自动进行，而用户是看不见这种调用过程的。   因此，在虚拟的 IP 网络上用 IP 地址进行通信给广大的计算机用户带来很大的方便

### 8.3. 试回答下列问题：

(1) 子网掩码为255.255. 255.0 代表什么意思？
(2) 一网络现在的掩码为255.255. 255.248, 问该网络能够连接多少个主机？
(3) -A 类网络和一B 类网络的子网号subnet-id 分别为16 个 1  和8 个 I, 问这两个网络的子网掩码有何不同？
(4) 一个 B 类地址的子网掩码是 255.255.240.0, 试问在其中每一个子网上的主
机数最多是多少？
(5) A类网络的子网掩码为255.255.0.255, 它是否为一个有效的子网掩码？际意义？为什么？
(6) 某个IP 地址的十六进制表示是C2.2F.14.81. 试将其转换为点分十进制的形式。这个地址是哪一类IP 地址？
(7) C 类网络使用子网掩码有无实际意义？为什么？

**解答：**

	(1) 可以是C 类地址对应的子网掩码默认值，也可以是A 类或B 类地址的掩码，这时主
机号由最后8 位决定，而路由器寻找网络由前24 位决定。
	(2) 分析一下IP 地址中最后一个字节：
248= 128 +64+32+ 16+8, 一共用掉8 位中的5 位，剩下3 位分配给主机号。扣除全0
	(3) A 类网络的掩码前面有8 个1, 子网号subnet-id 用了 16 个1, 因此掩码有24 个 1 和8 个0。
		  B 类网络的掩码前面有 16 个 I,  子网号subnet-id 用了 8 个 1,  因此掩码有24 个 l  和 8
个0。
		  可见这两个网络的子网掩码一样，但它们的子网数目不同。
![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028740856-41aee8c2-a6ba-4c73-befd-001e82dd8f71.png#clientId=u4d4fe1f6-f383-4&id=yOZOk&name=image.png&originHeight=467&originWidth=896&originalType=binary&ratio=1&rotation=0&showTitle=false&size=251152&status=done&style=none&taskId=u16d2a3f8-cf4a-4ba4-a547-ee24387cbbc&title=)

### 8.4. 设某路由器建立了如下路由表：

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028741055-f3a8b973-d32d-4269-90bc-61106ff37dac.png#clientId=u4d4fe1f6-f383-4&id=PgO5x&name=image.png&originHeight=427&originWidth=495&originalType=binary&ratio=1&rotation=0&showTitle=false&size=110112&status=done&style=none&taskId=u25d2d152-2177-4aa4-95bc-ca18a4591ed&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028741371-db23a741-2183-4931-b1cf-e7096bc53267.png#clientId=u4d4fe1f6-f383-4&id=ULtlz&name=image.png&originHeight=386&originWidth=897&originalType=binary&ratio=1&rotation=0&showTitle=false&size=210784&status=done&style=none&taskId=uf6ce83b8-0389-4930-93c6-bb1af887f48&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028741648-c6556c86-25e1-4572-bd29-1c7a72601d4b.png#clientId=u4d4fe1f6-f383-4&id=j0fF6&name=image.png&originHeight=1302&originWidth=737&originalType=binary&ratio=1&rotation=0&showTitle=false&size=532194&status=done&style=none&taskId=uc82ee14b-593d-4537-bb27-6e46a91e724&title=)![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028742374-3b19118a-4265-4026-8fe8-ad94a3da2bae.png#clientId=u4d4fe1f6-f383-4&id=MyHhC&name=image.png&originHeight=1249&originWidth=743&originalType=binary&ratio=1&rotation=0&showTitle=false&size=480217&status=done&style=none&taskId=u38491d91-1587-43f9-a197-9db63b11bb6&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028742375-e4ca219a-d886-49a6-b298-752766b58af3.png#clientId=u4d4fe1f6-f383-4&id=med6c&name=image.png&originHeight=1302&originWidth=737&originalType=binary&ratio=1&rotation=0&showTitle=false&size=532194&status=done&style=none&taskId=u57489646-8168-4415-8dd5-9abec2a5975&title=)![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028742498-e02eaf90-4d70-4bdb-9279-9a7b730507e1.png#clientId=u4d4fe1f6-f383-4&id=B3RoC&name=image.png&originHeight=1249&originWidth=743&originalType=binary&ratio=1&rotation=0&showTitle=false&size=480217&status=done&style=none&taskId=u3b294c44-8c33-40fa-9f2a-e813f5c5429&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028743563-de3822ba-d08f-4b26-acfa-bcb20f0630e1.png#clientId=u4d4fe1f6-f383-4&id=dCjNn&name=image.png&originHeight=1158&originWidth=736&originalType=binary&ratio=1&rotation=0&showTitle=false&size=490468&status=done&style=none&taskId=ub56da66a-4c10-4630-927a-5184b9c5d4d&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028743830-e105fc11-7ed9-4b8e-9d00-243531c982f5.png#clientId=u4d4fe1f6-f383-4&id=dtOQh&name=image.png&originHeight=831&originWidth=734&originalType=binary&ratio=1&rotation=0&showTitle=false&size=315826&status=done&style=none&taskId=u97cb57ac-746b-4fd8-8df8-9bac23ef9b3&title=)

### 8.5. 某单位分配到一个B 类IP 地址，其net-id 为 129.250.0.0。该单位有4000 台机器，平均分布在 16 个不同的地点。如选用子网掩码为 255.255.255.0, 试给每

一个地点分配一个子网号码，并算出每个地点主机号码的最小值和最大值。

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028744023-cfc13d9a-a6a0-46c8-96c8-e8be2d74938b.png#clientId=u4d4fe1f6-f383-4&id=wFzYT&name=image.png&originHeight=235&originWidth=895&originalType=binary&ratio=1&rotation=0&showTitle=false&size=143972&status=done&style=none&taskId=ud65c36bf-aff7-408f-ba76-0b253c16bb2&title=)

### 8.6. 某单位分配到一个地址块136.23.12.64/26。现在需要进一步划分为4 个一样大的子网。试问：

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028744082-b9c967ed-9193-42f4-8a3f-ad645bfe93ad.png#clientId=u4d4fe1f6-f383-4&id=cKQ1t&name=image.png&originHeight=128&originWidth=633&originalType=binary&ratio=1&rotation=0&showTitle=false&size=48613&status=done&style=none&taskId=u04cfcfdc-7bdc-4118-857f-b1fde2ec1af&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028744535-d7dac9e0-b30b-4e8b-827c-acd8b08d6003.png#clientId=u4d4fe1f6-f383-4&id=TXP1r&name=image.png&originHeight=622&originWidth=896&originalType=binary&ratio=1&rotation=0&showTitle=false&size=285386&status=done&style=none&taskId=ub601036b-2cb9-4ab0-a940-10b0435a809&title=)

					最大地址是BI B2 B3 01111110 = 136.23.12.126/28。

### 8.7. 假定网络中的路由器 B 的路由表有如下的项目（这三列分别表示“目的网络”“距离”和“下一跳路由器"):

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028744664-4d3a60dc-67d0-4ea8-a3f3-5f4f081ed492.png#clientId=u4d4fe1f6-f383-4&id=MeJb2&name=image.png&originHeight=316&originWidth=761&originalType=binary&ratio=1&rotation=0&showTitle=false&size=77081&status=done&style=none&taskId=u9c7d58e7-30ef-41fe-8d57-b274bc7f74a&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028744950-41860888-badc-4a0c-aeaa-551a4fb400c9.png#clientId=u4d4fe1f6-f383-4&id=uqv5p&name=image.png&originHeight=350&originWidth=607&originalType=binary&ratio=1&rotation=0&showTitle=false&size=91032&status=done&style=none&taskId=u7ab17812-bb38-4487-afa8-dfc9f7ae865&title=)

### 8.8. 假定网络中路由器A 的路由表有如下项目（格式同上题）：

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028745036-4df211b9-e487-449a-9c2f-7c4e75069f21.png#clientId=u4d4fe1f6-f383-4&id=VFe5v&name=image.png&originHeight=103&originWidth=196&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7908&status=done&style=none&taskId=uffe267b7-95df-42d2-8bb9-e99fbc7d39f&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028745671-0849241b-d2e6-460c-b61e-7cfb3734c829.png#clientId=u4d4fe1f6-f383-4&id=DAYoq&name=image.png&originHeight=164&originWidth=560&originalType=binary&ratio=1&rotation=0&showTitle=false&size=54499&status=done&style=none&taskId=u49867640-f8d5-4444-833d-caa4878eff3&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028745700-5439d083-33c9-433e-bdc8-517455a5f939.png#clientId=u4d4fe1f6-f383-4&id=ICpqh&name=image.png&originHeight=276&originWidth=548&originalType=binary&ratio=1&rotation=0&showTitle=false&size=80566&status=done&style=none&taskId=u3c182146-abe2-40d0-b613-c2afc530455&title=)

### 8.9. 某单位分配到一个起始地址为14.24.74.0/24 的地址块。该单位需要用到三个子网，他们的三个子地址块的具体要求是：子网N1 需要120 个地址，子网N2 需要60 个地址，子网N3 需要10 个地址。请给出地址块的分配方案

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028746135-e49395e8-6d7d-45db-aee8-f875a1219787.png#clientId=u4d4fe1f6-f383-4&id=AHBRZ&name=image.png&originHeight=652&originWidth=894&originalType=binary&ratio=1&rotation=0&showTitle=false&size=357082&status=done&style=none&taskId=ucbe10bee-db2b-44fc-aa5b-074dde88ecb&title=)

### 8.10. 主机A 向主机B 连续发送了两个TCP 报文段，其序号分别是70 和 100。试问：

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028746121-550ef6ce-4249-443a-8c23-55a8e26e044b.png#clientId=u4d4fe1f6-f383-4&id=UpMOS&name=image.png&originHeight=230&originWidth=894&originalType=binary&ratio=1&rotation=0&showTitle=false&size=149670&status=done&style=none&taskId=udc6b43c6-3bca-4595-ab41-be98898a91c&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028746354-dad61721-fb91-4c7e-8c8b-fede1dd9df04.png#clientId=u4d4fe1f6-f383-4&id=pL6pm&name=image.png&originHeight=199&originWidth=966&originalType=binary&ratio=1&rotation=0&showTitle=false&size=138491&status=done&style=none&taskId=uc5bd8473-bdef-4f02-a23d-46db422d4b6&title=)

### 8.11. 假定TCP 在开始建立连接时，发送方设定超时重传时间RTO== 6 秒。

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028746569-fc42ea60-420b-40f9-9c87-904f07ba305b.png#clientId=u4d4fe1f6-f383-4&id=acQyH&name=image.png&originHeight=151&originWidth=903&originalType=binary&ratio=1&rotation=0&showTitle=false&size=89180&status=done&style=none&taskId=ud7179155-3c00-4ce6-8244-1a2bfc9f88d&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028746667-5341acf4-aabc-4f63-a20e-dbdd167e7a53.png#clientId=u4d4fe1f6-f383-4&id=w5FAm&name=image.png&originHeight=552&originWidth=983&originalType=binary&ratio=1&rotation=0&showTitle=false&size=285296&status=done&style=none&taskId=ufbf294c2-0d01-4eef-aaf1-9d94278f81d&title=)

### 8.12. TCP 的拥塞窗口cwnd 大小与传输轮次n 的关系如表T-5-39 所示：

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028746944-b4f58b5a-5824-4776-9c4f-b00a464a91aa.png#clientId=u4d4fe1f6-f383-4&id=tu6VZ&name=image.png&originHeight=167&originWidth=782&originalType=binary&ratio=1&rotation=0&showTitle=false&size=110585&status=done&style=none&taskId=u956e790d-16f3-4433-8366-4a945b97661&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028747448-08e1e632-059e-496b-8566-d234059b8c31.png#clientId=u4d4fe1f6-f383-4&id=ogj7r&name=image.png&originHeight=431&originWidth=923&originalType=binary&ratio=1&rotation=0&showTitle=false&size=235159&status=done&style=none&taskId=u615dc245-084b-4b6c-823e-ab2494e43eb&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028748687-8ae0a6bd-f79d-494f-a42f-b21d44fea5c9.png#clientId=u4d4fe1f6-f383-4&id=lGJw6&name=image.png&originHeight=1134&originWidth=1089&originalType=binary&ratio=1&rotation=0&showTitle=false&size=617481&status=done&style=none&taskId=ua071c8e1-8da3-4c80-b37f-7da98cbd1cf&title=)

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028747824-182af276-f348-4b96-b232-560ab220ee86.png#clientId=u4d4fe1f6-f383-4&id=cnnF8&name=image.png&originHeight=437&originWidth=1061&originalType=binary&ratio=1&rotation=0&showTitle=false&size=237331&status=done&style=none&taskId=u64dc7cb9-30fd-42d2-b9d3-ee31e24f323&title=)

### 8.13. 流量控制和拥塞控制的最主要的区别是什么？发送窗口的大小取决千流量控制还是拥塞控制？

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028748553-fe538b1a-fd6a-4070-967a-c05f71ee5a87.png#clientId=u4d4fe1f6-f383-4&id=S31xe&name=image.png&originHeight=394&originWidth=1067&originalType=binary&ratio=1&rotation=0&showTitle=false&size=363921&status=done&style=none&taskId=u05e3963e-234f-4e00-83eb-f3013bac350&title=)

# 五、传输层

## 1. **运输层的两个主要协议**

### 1.1. 两个主要协议

        (1)用户数据报协议(UDP)

        (2)传输控制协议(TCP)

**UDP：**

       在传送数据之前不需要先建立连接，远地主机收到UDP报文后，不需要给出确认，UDP不提供可靠交付，但某些情况却是最有效的工作方式

**TCP：**

       提供面向连接的服务，在传送数据前先建立连接，数据传送结束后要释放连接；TCP不提供广播或多播服务；TCP提供可靠的、面向连接的运输服务，因此增加了很多开销

UDP特点：

- UDP是无连接的：发生数据之前无需建立连接，减少了开销和发送数据之前的时延
- UDP使用尽最大可能交付：不保证可靠交付，因此主机不需要维持复杂的连接状态表
- UDP是面向报文的：UDP对应用层交下来的报文不做处理，直接加上首部后就转发，若报文过长，IP层会进行分片，可能使IP层效率降低

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028748191-4c796eb2-44f3-49a8-8ece-a39ac9aebf7a.png#clientId=u4d4fe1f6-f383-4&id=KBoPZ&name=image.png&originHeight=338&originWidth=794&originalType=binary&ratio=1&rotation=0&showTitle=false&size=116473&status=done&style=none&taskId=u672f2073-de2a-4a55-b595-2c0808cdbaf&title=)

- UDP没有拥塞控制：因此网络出现拥塞不会使源主机发送速率降低，对实时应用很重要
- UDP支持一对一、一对多、多对一和多对多的交互通信
- UDP的首部开销小：只有8字节，比TCP的20字节首部短

**UDP的首部格式**：

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028748814-e50dcf61-0ecd-4dbd-a61c-4540ec47aeb2.png#clientId=u4d4fe1f6-f383-4&id=J21LC&name=image.png&originHeight=550&originWidth=1032&originalType=binary&ratio=1&rotation=0&showTitle=false&size=233135&status=done&style=none&taskId=u40df5566-02ae-47cc-87cf-ced95d9fc3e&title=)

-  伪首部：只在计算校验和时使用，不参与数据传输 
-  源端口：源端口号；在需要对方回信时选用；不需要时用全0 
-  目的端口：目的端口号；在终点交付报文时必须使用 
-  长度：UDP用户数据报的长度，最小值是8(仅有首部) 
-  校验和：检测UDP用户数据报在传输过程中是否有错。有就丢弃 

**TCP的主要特点**：

- TCP是面向链接的运输层协议：在使用TCP协议之前，必须先建立连接
- 每一条TCP链接只能有两个端点，每一条TCP连接只能是点对点的
- TCP提供可靠交付的服务：保证数据无差错、不丢失、不重复、按序到达
- TCP提供全双工通信：允许通信双方任何时候都能发送数据
- 面向字节流：

            流指的是流入到进程或从进程流出的字节序列；TCP把应用程序交下来的数据仅看作一串无结构的字节流

### 1.2. **超时重传时间的选择**

**加权平均往返时间RTTs：**

            新的RTTs=(1-α) _ (旧的RTTs)+α _(新的RTT样本)

**超时重传时间RTO：**

            RTO=RTTs+4*RTTD

**RTT的偏差的加权平均值RTTD：**

            新的RTTD=(1-β)_ (旧的RTTD)+β_|RTTs-新的RTT样本|    其中β=0.25

**Karn算法：**

            在计算加权平均RTTs时，只要报文段重传了，就不采用其往返时间样本，这样得出的加权平均RTTs和RTO就较准确

### 1.3. **TCP的流量控制**

**利用滑动窗口实现流量控制：**：

流量控制：让发送方发送速率不要太快，让接收方来得及接收

       滑动窗口的单位：字节

       滑动窗口流量控制流程：

           开始时rwnd=400，每个报文段长100字节

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028748974-f345642c-1d29-486a-a05d-845f4a4d781e.png#clientId=u4d4fe1f6-f383-4&id=f075x&name=image.png&originHeight=520&originWidth=978&originalType=binary&ratio=1&rotation=0&showTitle=false&size=211661&status=done&style=none&taskId=u94ed21c1-52e3-453f-b3b0-630bd7abd42&title=)

持续计时器：解决盲等死锁。只要TCP连接的一方收到对方的零窗口通知，就启动持续计时器，若计时器到期，就发送一个零窗口探测报文段，而对方就在确认这个报文段时给出了现在的窗口值，若窗口值仍是零，那么收到报文的一方就重新设置持续计时器，若不是零，那么死锁就被打破

**TCP的传输效率:**

- Nagle算法：

            若发送应用进程要把发送的数据逐个字节地送到TCP发送缓存，则发送方就把第一个数据字节先发送出去，把后面到达的数据字节都缓存起来。当发送方收到对第一个数据字符的确认后，再把发送缓存中的所有数据组装成一个报文发送出去，同时继续对后到达的数据进行缓存。只有在收到对前一个报文段的确认后才继续发送下一个报文段

-  糊涂窗口综合征：接收缓存每次只能释放出1字节空间，然后把窗口设为1，向发送方发送确认，发送方又发来1字节数据，接收方发回确认，仍将窗口设为1字节，这样会使网络效率降低 
-  解决方法：让接收方等待一段时间，使得接收缓存有足够空间容纳一个最大的报文段，或等接收缓存中有一半空闲空间。此时再发送确认报文 

### 1.4. **TCP的拥塞控制方法**

1. 慢开始
2. 拥塞避免
3. 快重传
4. 快恢复

### 1.5. **TCP的连接建立**

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028749552-ffaf9d0d-3282-4ddf-84ef-2a1c42eaac78.png#clientId=u4d4fe1f6-f383-4&id=ko1YX&name=image.png&originHeight=497&originWidth=819&originalType=binary&ratio=1&rotation=0&showTitle=false&size=169784&status=done&style=none&taskId=u72fb4855-2738-463d-bf4e-e89702dc9da&title=)

**流程：**

1.  最初两端TCP进程都处于关闭状态，开始时B的TCP服务器进程先创建传输控制块TCB，准备接受客户进程的连接请求，然后进入收听状态； 
2.  A的TCP客户进程也先创建TCB，然后打算建立TCP连接时，向B发送连接请求报文，这是首部中同步位SYN=1，同时选择一个初始序号seq=x，TCP规定，SYN报文段不能携带数据，但要消耗一个序号，这时TCP客户进程进入同步已发送状态； 

    3.  B收到连接请求报文后，若同意建立连接，则向A发送确认。在确认报文中将SYN位和ACK位都置1，确认号时ACK=x+1，同时也为自己选择一个初始序号seq=y。这个报文段也不能携带数据，但同样消耗一个序号，这时TCP服务器进程进入同步收到状态

4.  TCP客户进程收到B的确认后，还要向B给出确认。确认报文的ACK置1，确认号ack=y+1，而自己的序号seq=x+1。TCP规定，ACK报文段可以携带数据，但如果不携带数据则不消耗序号，这种情况，下一个数据报文段序号仍是seq=x+1。这时TCP连接已经建立，A进入已建立连接状态 
5.  B收到A的确认后，也进入已建立连接状态 

**必要性**：TCP通过三次握手建立**可靠的（确保收到）**的**全双工**通信。

                1)  第一次握手和第二次握手（ACK部分）建立了从客户端到服务器传送数据的可靠连接；

2）第二次握手（SYN部分）和第三次握手建立了从服务器到客户端传送数据的可靠连接；

4）由于我们期望建立全双工连接，所以两个方向的通信都是需要的，于是合并了服务器发送的ACK和SYN。

               5）**第三次握手的必要性：防止已失效的请求报文段突然又传送到了服务端而造成连接的误判**。假如客户端发出连接请求A，由于网络原因，服务端并没有收到A，于是客户端又发送了连接请求B，并建立了连接，完成通信，断开连接。这时候，服务端突然又收到了A，于是看作是一次新的连接请求，进行第二次握手，由于不存在第三次握手，所以这时已经建立了TCP连接。但实际上客户端并没有发起连接，所以不会传递数据，那么这条连接就会变成一条死连接。

### 1.6. **TCP连接的释放**

![image.png](https://cdn.nlark.com/yuque/0/2022/png/22139374/1664028749858-adbacf3a-1cee-4154-9718-a636e3e51855.png#clientId=u4d4fe1f6-f383-4&id=u7yla&name=image.png&originHeight=584&originWidth=836&originalType=binary&ratio=1&rotation=0&showTitle=false&size=215240&status=done&style=none&taskId=ucc3aabc0-5602-42a4-bcdf-626671f5be6&title=)

流程：

1.  起始时A和B都处于已建立连接状态 
2.  A的应用进程先向其TCP发出连接释放报文段，并停止再发送数据，主动关闭TCP连接，A把连接释放报文段首部的终止控制位FIN置1，序号seq=u，它等于前面已传送过的数据的最后一个字节的序号+1。这时A进入终止等待状态。FIN报文段即使不携带数据，也消耗一个序号 
3.  B收到连接释放报文后发出确认，确认号是ack=u+1，而这个报文自己的序号是v，等于B前面已传送过的数据的最后一个字节的序号+1。然后B进入关闭等待状态，TCP服务器进程通知高层应用进程，因而从A到B这个方向的连接就释放了，这时的TCP连接处于半关闭状态，即A已经没有数据要发送了，但B若发送数据，A仍要接受 
4.  A收到来自B的确认后，进入终止等待2状态，等待B发送的连接释放报文段 
5.  若B已经没有要向A发送的数据，应用进程就通知TCP释放连接，此时B发出的连接释放报文段FIN=1，假定现在B的序号为w，B还必须重复上次已发送过的确认号ack=u+1，此时B进入最后确认状态，等待A的确认 
6.  A在收到B的链接释放报文后，必须对此发出确认，在确认报文段中把ACK置1，确认号ack=w+1，而自己的序号时seq=u+1，然后进入时间等待状态。此时TCP连接还没有释放，;必须经过时间等待计时器设置的时间2MSL后，A才进入关闭状态。 

**A等待2MSL时间的原因**：

-  保证A发送的最后一个ACK报文段能够到达B 
-  防止已失效的连接请求报文段出现在本连接中 

### 1.7. 习题

# 六、应用层

## 0.1. **域名系统DNS**

**域名系统概述：**

域名系统DNS：是互联网使用的命名系统，用来把便于人们使用的机器名字转换为IP地址

1. 许多应用层软件经常使用域名系统DNS，但计算机的用户只是间接而不是直接使用DNS
2. 互联网采用层次结构的命名树作为主机的名字，并使用分布式的域名系统DNS
3. DNS使大多数名字都在本地进行解析，仅少量解析需要互联网上通信

## 0.2. **文件传送协议FTP**

FTP概述

**文件传输协议FTP：**时互联网上使用最广泛的文件传送协议，提供交互式访问，允许客户指明文件的类型与格式，并允许文件具有存取权限

**特点：**要存取一个文件，必须先获得一个本地的文件副本，要修改文件，只能对副本进行修改，然后将修改后的文件副本传回原节点
